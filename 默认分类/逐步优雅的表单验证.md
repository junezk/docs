# é€æ­¥ä¼˜é›…çš„è¡¨å•éªŒè¯

## ç¼˜èµ·

æœ€è¿‘è¢« Jasmine äº§å“å¤§å¤§çš„éœ€æ±‚è€½æäº†æŒºé•¿æ—¶é—´ï¼Œè®¸ä¹…æ²¡è½ç¬”ï¼Œå¿ƒé‡Œæœ‰ç‚¹æƒ¶æï¼Œæ‰€ä»¥ç‰¹æ­¤æ²‰æ·€ä»¥ç¼“è§£ç„¦è™‘ğŸ˜‚ã€‚ä»Šå¤©ä¸»è¦åˆ†äº«çš„æ˜¯å…³äºè¡¨å•éªŒè¯çš„ä¸€äº›çŸ¥è¯†ï¼Œå¤§å®¶åº”è¯¥éƒ½æ™“å¾—ï¼Œå°±æ˜¯éªŒè¯ç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºå·å•¥çš„ï¼Œè™½ç„¶é£Ÿä¹‹æ— å‘³ï¼Œä½†å¼ƒä¹‹å¯æƒœğŸ˜¬ã€‚
é€šå¸¸æ¥è¯´è¡¨å•éªŒè¯å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå³æ—¶éªŒè¯ï¼ˆæœ¬åœ°æ ¡éªŒï¼‰å’Œå¼‚æ­¥éªŒè¯ï¼ˆæ¯”å¦‚ç”¨æˆ·åæ˜¯å¦å¯ç”¨ã€éªŒè¯ç ç­‰ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯å‰ç«¯æ ¡éªŒå’Œåç«¯æ ¡éªŒï¼ˆå·¥ä½œä¸­å‰åç«¯éƒ½æ˜¯è¦æ ¡éªŒçš„ï¼Œä»¥ä¿è¯æœ€ç»ˆæ•°æ®çš„å‡†ç¡®æ€§å’Œæœ‰æ•ˆæ€§ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿåº”è¯¥éƒ½æœ‰æ ¡éªŒ ğŸ˜ï¼‰ï¼Œè€Œæˆ‘ä»¬ä»Šå¤©ä¸»è¦è®²è§£çš„å°±æ˜¯å‰ç«¯çš„è¡¨å•æ ¡éªŒã€‚

## ç›®æ ‡

ğŸ‘Œï¼Œé¦–å…ˆæˆ‘ä»¬ç®€è¦è¯´ä¸‹è¦å®ç°çš„ç›®æ ‡åŠŸèƒ½ï¼š

- å…·æœ‰åŸºç¡€çš„è¡¨å•éªŒè¯åŠŸèƒ½
- æä¾›ä¸€äº›å†…ç½®éªŒè¯è§„åˆ™
- æä¾›å¯¹å¤–å¼€æ”¾çš„èƒ½åŠ›

äº‹å®ä¸Šè¡¨å•éªŒè¯æ˜¯å¯ä»¥è„±ç¦»é¡µé¢å­˜åœ¨çš„ï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼ˆæ•°æ®å’Œè§„åˆ™ï¼‰ï¼Œç„¶åè¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒå‡ºé”™åˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚æ„æ€å¤§å®¶åº”è¯¥éƒ½æ˜ç™½ï¼Œä¹Ÿéƒ½å†™è¿‡ï¼Œä½†å¦‚ä½•å†™çš„ä¼˜é›…ç‚¹å‘¢ï¼Œæˆ–è€…è®©å¼€å‘ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿å‘¢ï¼Œè®©æˆ‘ä»¬ä» 0 åˆ° 1 å¾€ä¸‹çœ‹å§ğŸ§ã€‚

## ç¬¬ä¸€ç‰ˆ

Soï¼Œä¸‡äº‹å¼€å¤´éš¾ğŸ¤¨ï¼Œè¯¥ä»ä½•ä¸‹æ‰‹å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬çš„æ€è·¯å°±ä¸¤æ­¥ï¼š

1. é¦–å…ˆè·å–åˆ°è¦æ ¡éªŒçš„å€¼å’Œè§„åˆ™ï¼›
2. ç„¶åè¿›è¡Œç›¸åº”çš„è§„åˆ™æ ¡éªŒï¼Œå¹¶è¿”å›æ ¡éªŒç»“æœã€‚

å…·ä½“ç‚¹è¯´å°±æ˜¯æˆ‘ä»¬è¦å†™ä¸€ä¸ªå‡½æ•°å¹¶ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼ˆæ•°æ®å’Œè§„åˆ™ï¼‰ï¼Œå¦å¤–å®ƒè¿˜åº”è¯¥è¿”å›ä¸ªé”™è¯¯å¯¹è±¡ï¼Œå°±åƒä¸‹é¢è¿™æ ·ğŸ‘‡ï¼š

```js
function validate(data, rules) {
    // ...
}
// æ•°æ®å¤§æ¦‚é•¿è¿™æ ·
let data = {
    name: 'xxx',
    phone: '138xxxxxxxx'
}
// è§„åˆ™å¤§æ¦‚é•¿è¿™æ ·ï¼Œä¸ºä»€ä¹ˆé•¿è¿™æ ·ï¼Œä½ ç”¨è¿‡ä¸€äº› UI æ¡†æ¶åº”è¯¥ä¼šæœ‰ç‚¹æ„Ÿè§‰
let rules = [{
    key: 'name',
    required: true,
    minLen: 6,
    maxLen: 10
}, {
    key: 'phone',
    pattern: 'phone'
}]
// é”™è¯¯ä¿¡æ¯å¤§æ¦‚é•¿è¿™æ ·
let errors = {
    name: {
        required: 'å¿…å¡«',
        minLen: 'å¤ªçŸ­äº†',
        maxLen: 'å¤ªé•¿äº†'
    },
    phone: {
        pattern: 'æ‰‹æœºæ ¼å¼ä¸å¯¹'
    }
}
```

ä¸Šé¢è¿™æ®µçœ‹ä¼¼ç®€å•çš„ä»£ç å…¶å®æš—è—ç„æœºï¼Œè¿™é‡Œæˆ‘ä¸»è¦å¼ºè°ƒä»¥ä¸‹ä¸¤ä¸‰ä¸ªç‚¹ï¼š

- è§„åˆ™ rules æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºåœ¨å®é™…å·¥ä½œä¸­æˆ‘ä»¬æ—¶å¸¸éœ€è¦æŒ‰é¡ºåºæ ¡éªŒï¼Œæ‰€ä»¥è¦å†™æˆæ•°ç»„çš„å½¢å¼ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯æ ¹æ® rules çš„é¡ºåºå»æ ¡éªŒå¯¹åº”çš„ dataã€‚
- æ¯ä¸ªæ•°æ®è¿”å›çš„é”™è¯¯ä¿¡æ¯å¯èƒ½æœ‰å¤šä¸ªï¼Œæˆ‘ä»¬æ˜¯åªå±•ç¤ºä¸€ä¸ªè¿˜æ˜¯éƒ½å±•ç¤ºå‘¢ï¼Ÿå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ä¸‹ğŸ¤”ã€‚ã€‚ã€‚okï¼Œè°œåº•æ­æ™“ï¼Œé€šå¸¸æˆ‘ä»¬åªè¦è®°å½•ä¸€ä¸ªé”™è¯¯å³å¯ï¼Œå› ä¸ºåœ¨é¡µé¢ä¸Šä¸€èˆ¬åªå±•ç¤ºä¸€ä¸ªé”™è¯¯æç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´æŸä¸ªæ•°æ®é”™äº†ï¼Œå°±ä¸è¦éªŒè¯è¯¥æ•°æ®çš„å…¶ä»–é”™è¯¯äº†ï¼Œæ²¡æœ‰é‚£ä¸ªå¿…è¦ï¼Œä¸è¿‡æœ¬ç¯‡æ–‡ç« ä¼šæŠŠé”™è¯¯å…¨éƒ½å±•ç¤ºå‡ºæ¥ğŸ˜¯ï¼Œå“ˆå“ˆã€‚
- å¦å¤–ï¼Œæ¯ä¸ª rule ä¸­çš„ `required` å­—æ®µçš„ä¼˜å…ˆçº§æ€»æ˜¯æœ€é«˜çš„ï¼Œå®ƒç›¸å¯¹äºå…¶ä»–è§„åˆ™æ¯”è¾ƒç‰¹æ®Šï¼Œæ¯•ç«Ÿå€¼éƒ½æ²¡æœ‰ï¼Œè¦å…¶å®ƒè§„åˆ™æœ‰ä½•ç”¨ã€‚

ç„¶åæˆ‘ä»¬åªè¦å®Œå–„éªŒè¯å‡½æ•°å°±è¡Œäº†ï¼Œå¤§ä½“æ€è·¯å°±æ˜¯å¾ªç¯ rulesï¼Œæ‹¿åˆ°å¯¹åº”çš„ data å€¼è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœ‰é”™è¯¯å°±å†™åˆ° `errors` é‡Œé¢ï¼Œå°±åƒä¸‹é¢è¿™æ ·ğŸ‘‡ï¼š

```js
function validate(data, rules) {
    let errors = {};  // æœ‰é”™è¯¯çš„è¯æ”¾è¿™é‡Œé¢
    rules.forEach(rule => {
        let val = data[rule.key]
        if (rule.required) {
            if (!val && val !== 0) {
                setDefaultObj(errors, rule.key) // è¿™ä¸ªå‡½æ•°åœ¨ä¸‹é¢ï¼Œç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿ errors[rule.key] æ˜¯ä¸ªå¯¹è±¡
                errors[rule.key].required = 'å¿…å¡«'
                return // å¦‚æœæ²¡å¡«å°±ç›´æ¥ return äº†ï¼Œä¸éœ€è¦å†è¿›è¡Œæ­¤æ•°æ®çš„å…¶ä»–æ ¡éªŒ
            }
        }
        if (rule.pattern) {
            if (rule.pattern === 'phone') {
                if(!/^1\d{10}$/.test(val)) { // ç®€å•æ ¡éªŒäº†ä¸€ä¸‹æ‰‹æœº
                    setDefaultObj(errors, rule.key)
                    errors[rule.key].pattern = 'æ‰‹æœºæ ¼å¼é”™è¯¯'
                }
            }
        }
        if (rule.minLen) {
            if (val.length < rule.minLen) {
                setDefaultObj(errors, rule.key)
                errors[rule.key].minLen = 'å¤ªçŸ­å•¦'
            }
        }
        if (rule.maxLen) {
            if (val.length > rule.maxLen) {
                setDefaultObj(errors, rule.key)
                errors[rule.key].maxLen = 'å¤ªé•¿å•¦'
            }
        }
        console.log(errors)
    });
}
function setDefaultObj(obj, key) { // ç¡®ä¿æ˜¯ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿äºèµ‹å€¼
    obj[key] = obj[key] || {}
}
```

è®©æˆ‘ä»¬ç”¨ node æ‰§è¡Œä¸€ä¸‹ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š

![img](é€æ­¥ä¼˜é›…çš„è¡¨å•éªŒè¯.assets/16d10ffe2982ae79)

æ²¡é”™ï¼Œä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€ç‰ˆçš„æ‰€æœ‰ä»£ç ï¼Œå·²ç»å†™å®Œäº†ğŸ˜ï¼Œå†…å®¹ä¸å¤šä¹Ÿå¥½ç†è§£ã€‚

- è¦æ˜¯å†å¤šæ¥å‡ ä¸ªæ ¡éªŒï¼Œè¿™å‡½æ•°å¾—èƒ–åˆ°ä»€ä¹ˆç¨‹åº¦
- è¿‡å¤šçš„ if-else è¯´æ˜æˆ‘ä»¬éœ€è¦è®©å®ƒä¼˜é›…ç‚¹
- æ²¡æœ‰ä»€ä¹ˆå¯å¤ç”¨æ€§
- è¿˜æœ‰äº›çœ‹ä¼¼é‡å¤çš„é€»è¾‘
- å¦‚æœæˆ‘ä»¬è¦æ”¹ä¸ªè§„åˆ™è¿˜è¦åˆ°å‡½æ•°é‡Œé¢æ”¹ï¼Œè¿åäº†å¼€æ”¾-å°é—­çš„åŸåˆ™

æ‰€ä»¥è®©æˆ‘ä»¬æ¥å°æ”¹ä¸€ä¸‹å§ğŸ¤¨ï¼ˆå°æ”¹æ€¡æƒ…ï¼Œå¤§æ”¹ä¼¤èº«ï¼‰ï¼Œå½“ç„¶ä½ è¿˜æ˜¯å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹ğŸ¤”ã€‚ã€‚ã€‚

## ç¬¬äºŒç‰ˆ

æˆ‘ä»¬é¦–å…ˆèƒ½æƒ³åˆ°çš„æ˜¯æŠŠ if-else æ‹¿å‡ºæ¥ï¼ŒæŠŠæ ¡éªŒçš„é€»è¾‘æå–åˆ°å¤–é¢ï¼Œé‚£å’‹æå‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“å‡½æ•°å…¶å®ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ ¡éªŒæ–¹æ³•ç›´æ¥å†™åˆ°å‡½æ•°çš„å±æ€§ä¸­ï¼Œå°±åƒ `fn.required = () => {}` æˆ–è€… `fn.pattern = () => {}` è¿™ä¸ªæ ·å­ï¼Œä¸‹é¢æ˜¯æ”¹å®Œä¹‹åçš„å…·ä½“ä»£ç ğŸ‘‡ï¼š

```js
function validate(data, rules) {
    let errors = {};  // æœ‰é”™è¯¯çš„è¯æ”¾è¿™é‡Œé¢
    rules.forEach(rule => {
        let val = data[rule.key]
        if (rule.required) {
            let error = validate.required(val)
            if (error) {
                setDefaultObj(errors, rule.key)
                errors[rule.key] = error
                return
            }
        }
        if (rule.pattern) {
            let error = validate.pattern(val, rule.pattern)
            if (error) {
                setDefaultObj(errors, rule.key)
                errors[rule.key].pattern = error
            }
        }
        if (rule.minLen) {
            let error = validate.minLen(val, rule.minLen)
            if (error) {
                setDefaultObj(errors, rule.key)
                errors[rule.key].minLen = error
            }
        }
        if (rule.maxLen) {
            let error = validate.maxLen(val, rule.maxLen)
            if (error) {
                setDefaultObj(errors, rule.key)
                errors[rule.key].maxLen = error
            }
        }
        console.log(errors)
    });
}
validate.required = (val) => {
    if (!val && val !== 0) {
        return 'å¿…å¡«'
    }
}
validate.pattern = (val, pattern) => { // pattern å¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„æ­£åˆ™ä¹Ÿå¯ä»¥æ˜¯å†…ç½®çš„
    if (pattern === 'phone') {
        if(!/^1\d{10}$/.test(val)) {
            return 'æ‰‹æœºæ ¼å¼é”™è¯¯'
        }
    } else if(!pattern.test(val)) {
        return 'æ‰‹æœºæ ¼å¼é”™è¯¯'
    }
}
validate.minLen = (val, minLen) => {
    if (val.length < minLen) {
        return 'å¤ªçŸ­å•¦'
    }
}
validate.maxLen = (val, maxLen) => {
    if (val.length > maxLen) {
        return 'å¤ªé•¿å•¦'
    }
}
```

æ”¹å®Œä¸€çœ‹ï¼Œä½ å¯èƒ½ä¼šå§æ§½ğŸ¤ï¼Œä»£ç é‡å¥½åƒæ²¡ä»€ä¹ˆå‡å°‘ï¼Œç”šè‡³é‡å¤çš„æ›´æ˜æ˜¾äº†ï¼Œç›¸å½“ä¸ä¼˜é›…å‘€ã€‚å§æ§½è™½ç„¶æ²¡é”™ï¼Œä½†å’Œç¬¬ä¸€ä¸ªç‰ˆæœ¬ç›¸æ¯”ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠè§„åˆ™æŠ½ç¦»å‡ºæ¥äº†ï¼Œè‡³å°‘ä¸ä¼šéƒ½å¡åœ¨ validate å‡½æ•°é‡Œï¼Œä½ å¯ä»¥ä¸“å¿ƒåœ°åœ¨å‡½æ•°å¤–é¢ä¿®æ”¹å¯¹åº”çš„è§„åˆ™ï¼Œä¹Ÿå¯åœ¨å‡½æ•°å¤–é¢æ·»åŠ å…¶å®ƒè§„åˆ™ã€‚
ä½†æ˜¯è¿™æ ·è¿˜ä¸å¤Ÿï¼Œåˆšæ‰è¯´çš„å‡ ä¸ªç¼ºç‚¹å¥½åƒä¹Ÿè¿˜åœ¨ï¼Œå°¤å…¶æ˜¯æ„Ÿè§‰ä¸‹é¢è¿™ä¸€æ®µå¾ˆé‡å¤ï¼Œä½ å¯ä»¥çœ‹åˆ°æ¯ä¸ª if-else éƒ½å†™çš„å·®ä¸å¤šï¼Œå°±ä¸€ä¸ªå•è¯ä¸ä¸€æ ·ï¼Œè¯´æ˜æˆ‘ä»¬å¯ä»¥ç»§ç»­æ”¹å†™å®ƒã€‚å…·ä½“æ€ä¹ˆæ”¹å†™ï¼Œåˆå¯ä»¥æ€è€ƒä¸€ä¸‹äº†ğŸ¤”ã€‚ã€‚ã€‚

```js
if (rule.required) {}
if (rule.pattern) {}
if (rule.minLen) {}
if (rule.maxLen) {}
```

## ç¬¬ä¸‰ç‰ˆ

å¾ˆç®€å•çš„ä¸€ä¸ªæƒ³æ³•å°±æ˜¯éå†å®ƒï¼Œåªä¸è¿‡æˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯æ¯ä¸ª rule é‡Œé¢çš„ `key: 'xxx'` å’Œ `required: true` æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œæˆ‘ä»¬è¦å°†ä»–ä»¬æ’é™¤åœ¨å¤–ï¼Œéå†å…¶å®ƒè§„åˆ™å³å¯ï¼Œå…¶å®ƒè§„åˆ™å¯ä»¥çœ‹åšæ˜¯å¹³ç­‰çš„ã€‚å…·ä½“çœ‹ä¸‹é¢çš„ä»£ç ğŸ‘‡ï¼Œæœ‰æ³¨é‡Šåº”è¯¥éƒ½èƒ½æ‡‚ğŸ™„ï¼š

```js
function validate(data, rules) {
    let errors = {};  // æœ‰é”™è¯¯çš„è¯æ”¾è¿™é‡Œé¢
    rules.forEach(rule => {
        let val = data[rule.key]
        if (rule.required) { // required æ¯”è¾ƒç‰¹æ®Šï¼Œå•ç‹¬å¤„ç†æ¯”è¾ƒåˆé€‚
            let error = validate.required(val)
            if (error) {
                setDefaultObj(errors, rule.key)
                errors[rule.key] = error
                return
            }
        }
        let restKeys = Object.keys(rule).filter(key => key !== 'key' && key !== 'required'); // è¿‡æ»¤æ‰ key å’Œ required
        restKeys.forEach(restKey => {
            if (validate[restKey]) { // è¿™é‡Œè¦æ³¨æ„è§„åˆ™å¯èƒ½ä¸å­˜åœ¨ï¼Œè¿™æ—¶å€™éœ€è¦ç»™ç”¨æˆ·ä¸€ä¸ªè­¦å‘Šæˆ–è€…æŠ¥é”™
                let error = validate[restKey](val, rule[restKey])
                if (error) {
                    setDefaultObj(errors, rule.key)
                    errors[rule.key][restKey] = error
                }
            } else {
                throw `${restKey} è§„åˆ™ä¸å­˜åœ¨`
            }
        })
    });
    console.log(errors)
    return errors
}
```

å“ˆå“ˆğŸ˜Šï¼Œç°åœ¨çœ‹èµ·æ¥å¥½æƒ³èˆ’æœç‚¹äº†ï¼Œä¸è¿‡è¿˜æ˜¯ç•¥æ˜¾åˆ«æ‰­ï¼Œé€šç”¨æ€§å’Œæ‰©å±•æ€§å¥½åƒä¹Ÿä¸å¤Ÿå¼ºã€‚å‡å¦‚æœ‰äººæŠŠè¿™ä¸ªä¸œä¸œæ”¹äº†ï¼Œä¼šå½±å“åˆ°å…¶ä»–äººå—ï¼Ÿåˆæˆ–è€…è§„åˆ™ä¸€å¤šä¼šå†²çªå—ï¼Ÿæ‰€ä»¥ï¼Œé—®é¢˜è¿˜æ˜¯æœ‰çš„ã€‚
äº‹å®ä¸Šæˆ‘ä»¬ç°åœ¨çš„æ ¡éªŒæ˜¯å…¬ç”¨çš„ï¼Œè€Œæˆ‘ä»¬éœ€è¦æŠŠè§„åˆ™åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å…¬ç”¨çš„ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰çš„ï¼ˆå¯è¦†ç›–å…¬ç”¨å¹¶ä¸”ä¸å½±å“ä»–äººï¼‰ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Œå…¶å®å°±æ˜¯ç”¨åŸå‹é“¾å’Œç»§æ‰¿æ¥æ”¹å†™å•¦ğŸ˜ï¼Œåˆå› ä¸ºç°åœ¨æœ‰äº† ES6ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ `prototype` æ¥å†™äº†ï¼Œè€Œæ˜¯ç”¨ `class`ï¼Œå®é™…ä¸Šä»–ä»¬æ˜¯ä¸€æ ·çš„ï¼Œè¯­æ³•ç³–å˜›ï¼Œå¥½åƒæ–¹ä¾¿ğŸ˜‹ã€‚

## ç¬¬å››ç‰ˆ

å¥½çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬ç”¨ `class` æ¥é‡å†™ä¸Šé¢çš„æ ¡éªŒå‡½æ•°ï¼ˆä¸æ‡‚ `class` å†™æ³•çš„å»ºè®®å…ˆå»çœ‹ä¸€ä¸‹ï¼ŒæŒºç®€å•çš„ï¼Œå°±æ˜¯æ¢ä¸ªå†™æ³•ï¼Œä¹ æƒ¯å°±å¥½ï¼‰ï¼Œè¿™é‡Œç›´æ¥ä¸Šä»£ç ğŸ‘‡ï¼š

```js
class Validator {
    constructor() {
    }
    static addRule (name, fn) { // å…¨å±€æ·»åŠ æ–°è§„åˆ™
        Validator.prototype[name] = fn
    }
    validate(data, rules) {
        let errors = {}
        rules.forEach(rule => {
            let val = data[rule.key]
            if (rule.required) {
                let error = this.required(val)
                if (error) {
                    this.setDefaultObj(errors, rule.key)
                    errors[rule.key] = error
                    return
                }
            }
            let restKeys = Object.keys(rule).filter(key => key !== 'key' && key !== 'required');
            restKeys.forEach(restKey => {
                if (this[restKey]) {
                    let error = this[restKey](val, rule[restKey])
                    if (error) {
                        this.setDefaultObj(errors, rule.key)
                        errors[rule.key][restKey] = error
                    }
                } else {
                    throw `${restKey} è§„åˆ™ä¸å­˜åœ¨`
                }
            })
        });
        console.log(errors)
    }
    required (val) {
        if (!val && val !== 0) {
            return 'å¿…å¡«'
        }
    }
    pattern (val, pattern) { // pattern å¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„æ­£åˆ™ä¹Ÿå¯ä»¥æ˜¯å†…ç½®çš„
        if (pattern === 'phone') {
            if(!/^1\d{10}$/.test(val)) {
                return 'æ‰‹æœºæ ¼å¼é”™è¯¯'
            }
        } else if(!pattern.test(val)) {
            return 'æ‰‹æœºæ ¼å¼é”™è¯¯'
        }
    }
    minLen (val, minLen) {
        if (val.length < minLen) {
            return 'å¤ªçŸ­å•¦'
        }
    }
    maxLen (val, maxLen) {
        if (val.length > maxLen) {
            return 'å¤ªé•¿å•¦'
        }
    }
    setDefaultObj (obj, key) {
        obj[key] = obj[key] || {}
    }
}
// å½“ç„¶ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿå¾—è·Ÿç€å˜ï¼Œä½†æ˜¯æ‰“å°çš„é”™è¯¯ä¿¡æ¯æ˜¯ä¸€æ ·çš„
let validator = new Validator()
validator.validate(data, rules)
```

æ˜¯ä¸æ˜¯æœ‰ç‚¹æ‹¨å¼€äº‘é›¾è§æœˆæ˜çš„æ„Ÿè§‰ğŸ¤¯ï¼Ÿæ²¡æœ‰å°±ç®—äº†ğŸ˜‚ï¼Œåæ­£ä¸Šé¢çš„è¿™ä¸ªå†™æ³•å’Œæœ€åˆçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ç›¸æ¯”åº”è¯¥æ˜¯è·¨å‡ºä¸€å°æ­¥äº†ï¼Œä¹Ÿæ˜“äºæ‰©å……å’Œç»´æŠ¤ï¼ŒæŒºå¥½ğŸ‘ğŸ‘ğŸ‘ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ç¬¬å››ç‰ˆçš„åŸºç¡€ä¸Šæ‰¹é˜…åè½½ã€å¢åˆ äº”æ¬¡ï¼Œè®©å®ƒå˜å¾—æ›´åŠ å®Œå–„å’Œä¼˜é›…ã€‚

## å°¾æµ

å›åˆ°å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¾€å¾€æ˜¯å†™äº† if-else ä¹‹åå°±ä¸æƒ³å»æ”¹å®ƒäº†ï¼Œè¿™åº”è¯¥æ˜¯æ¯”è¾ƒå°´å°¬çš„ä¸€ç‚¹äº†ğŸ˜‚ï¼Œæˆ‘ä¹Ÿæ˜¯ã€‚ ä¸è¿‡è¨€è€Œæ€»ä¹‹ï¼Œæƒ³è¦å†™çš„ä¼˜é›…ï¼Œå°±è¦å¤šå†™å¤šæ”¹ï¼Œæ¯”åŸæ¥å¥½å°±æ˜¯è¿›æ­¥ï¼Œè¿™æ˜¯ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€æ­¥åˆ°ä½ã€‚æœ€åå¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå¤§èµæ— ç–†å•¦ğŸ‘ğŸ‘ğŸ‘ã€‚ã€‚ã€‚
ps : å†™å®Œæ–‡ç« åäº§å“å¤§å¤§çªç„¶ç»™æˆ‘å°è®²äº†ä¸€ä¸‹ä¸‹ä¸ªéœ€æ±‚ï¼Œæˆ‘ä¸€å¬ï¼Œåˆè¦å¾ˆä¹…æ‰èƒ½æç¬”äº†ã€‚